"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?e(require("jquery")):e(jQuery)}(function(f){var a="qor.medialibrary.action",e="enable."+a,t="keyup."+a,r="switched.qor.tabbar.radio",i='[data-toggle="qor.tab.radio"]',l='[data-tab-source="video_link"]',s=".qor-video__link",o=".qor-medialibrary__video-link",n=".qor-medialibrary__video",c=".qor-medialibrary__desc",u=".qor-file__options",d=".qor-bottomsheets__mediabox";function m(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);return!(!t||11!=t[7].length)&&t[7]}function h(e){var t=e.match(/(\/id_)(\w+)/);return!!(/http?:\/\/(www\.)|(v\.)youku.com/.test(e)&&t&&t[2])&&t[2]}function b(e,t){this.$element=f(e),this.options=f.extend({},b.DEFAULTS,f.isPlainObject(t)&&t),this.init()}return b.prototype={constructor:b,init:function(){this.bind(),this.initMedia(),f.fn.qorSliderAfterShow.renderMediaVideo()},bind:function(){f(document).on(r,i,this.resetMediaData.bind(this)).on(t,s,this.setVideo.bind(this)).on(t,c,this.setImageDesc.bind(this)).on("reload.qor.bottomsheets bottomsheetLoaded.qor.bottomsheets",d,this.initMedia.bind(this,"bottomsheet"))},unbind:function(){f(document).off(r,i,this.resetMediaData.bind(this)).off(t,s,this.setVideo.bind(this)).off(t,c,this.setImageDesc.bind(this))},setMediaData:function(e,t){var r=e.find(u),i=e.find('input[name="QorResource.MediaOption"]');r.val(JSON.stringify(t)),i.val(JSON.stringify(t))},setImageDesc:function(e){var t,r,i=f(e.target),a=i.closest("form");t=a.find(u),(r=JSON.parse(t.val())).Description=i.val(),this.setMediaData(a,r)},initMedia:function(e){var t=f(n),r=f(o);e&&(t=f(d).find(n),r=f(d).find(o)),f(d).find(".qor-table--medialibrary-file").each(function(){f(this).closest(".mdl-card__supporting-text").addClass("qor-table--files")}),(t.length||r.length)&&(t.each(function(){var e=f(this),t=e.data("videolink");t&&t.match(/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/)&&e.parent().addClass("qor-table--video qor-table--video-internal").html('<video width=100% height=100% controls><source src="'+t+'"></video>')}),r.each(function(){var e=f(this),t=e.data("videolink"),r=m(t),i=h(t);r?e.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width="100%" height="100%" src="//www.youtube.com/embed/'+r+'?rel=0" frameborder="0" allowtransparency="true" allowfullscreen="true"></iframe>'):i?e.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width=100% height=100% src="http://player.youku.com/embed/'+i+'" frameborder=0 allowtransparency="true" allowfullscreen="true"></iframe>'):e.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width=100% height=100% src="'+t+'" frameborder=0 allowtransparency="true" allowfullscreen="true"></iframe>')}))},setVideo:function(e){var t=f(e.target),r=t.closest("[data-tab-source]"),i=t.closest("form"),a=i.find(u),o=JSON.parse(a.val()),n=t.val(),d=r.find("iframe"),l=m(n),s=h(n);o.SelectedType="video_link",o.Video=n,o.Description=r.find(c).val(),this.setMediaData(i,o),r.find("iframe").remove(),l||s?(d.length&&d.remove(),l&&r.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+l+'?rel=0" frameborder="0" allowtransparency="true" allowfullscreen="true"></iframe>'),s&&r.append('<iframe width=100% height=400 src="http://player.youku.com/embed/'+s+'" frameborder=0 allowtransparency="true" allowfullscreen="true"></iframe>')):r.append('<iframe width=100% height=400 src="'+n+'" frameborder=0  allowtransparency="true" allowfullscreen="true"></iframe>')},resetMediaData:function(e,t,r){var i=f(t),a=i.closest("form"),o=i.find(u),n=i.find(l).find(".qor-fieldset__alert"),d=JSON.parse(o.val());"video_link"==(d.SelectedType=r)&&(d.Video=i.find(s).val(),n.length&&n.remove()),d.Description=f('[data-tab-source="'+r+'"]').find(c).val(),f('[name="QorResource.SelectedType"]').val(r),this.setMediaData(a,d)},destroy:function(){this.unbind()}},b.DEFAULTS={},f.fn.qorSliderAfterShow=f.fn.qorSliderAfterShow||{},f.fn.qorSliderAfterShow.renderMediaVideo=function(){var e=f(l),t=f(c),r=e.length&&e.data().videourl,i=r&&m(r),a=r&&h(r);t.length&&t.val(t.data().imageInfo.Description),e.length&&r&&(i?e.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+i+'?rel=0&fs=0&modestbranding=1&disablekb=1" frameborder="0" allowtransparency="true" allowfullscreen="true"></iframe>'):a?e.append('<iframe width=100% height=400 src="http://player.youku.com/embed/'+a+'" frameborder=0 allowtransparency="true" allowfullscreen="true"></iframe>'):e.append('<iframe width=100% height=400 src="'+r+'" frameborder=0 allowtransparency="true" allowfullscreen="true"></iframe>'))},b.plugin=function(i){return this.each(function(){var e,t=f(this),r=t.data(a);if(!r){if(/destroy/.test(i))return;t.data(a,r=new b(this,i))}"string"==typeof i&&f.isFunction(e=r[i])&&e.apply(r)})},f(function(){var t=".qor-theme-media_library";f(document).on("disable.qor.medialibrary.action",function(e){b.plugin.call(f(t,e.target),"destroy")}).on(e,function(e){b.plugin.call(f(t,e.target))}).triggerHandler(e)}),b});